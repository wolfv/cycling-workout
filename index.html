<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zwift Hub Controller</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.2/dist/basecoat.cdn.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/basecoat-css@0.3.2/dist/js/all.min.js" defer></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="alpine-store.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar" data-side="left" aria-hidden="false">
        <nav aria-label="Main navigation">
            <section class="scrollbar">
                <div role="group">
                    <div class="pb-4 border-b border-border">
                        <div class="flex items-center gap-3 mb-4">
                            <i data-lucide="bike" class="w-7 h-7 text-accent"></i>
                            <h2 class="text-xl font-semibold">Zwift Hub</h2>
                        </div>
                        <div class="flex flex-col gap-2" x-data>
                            <button
                                onclick="app.connect()"
                                x-show="!$store.app.connected && !$store.app.connecting"
                                style="display: none;"
                                class="btn-sm w-full bg-blue-600 hover:bg-blue-700 text-white border-blue-600">
                                <i data-lucide="bluetooth"></i>
                                <span>Connect</span>
                            </button>
                            <button
                                x-show="$store.app.connecting"
                                style="display: none;"
                                disabled
                                class="btn-sm-outline w-full">
                                <i data-lucide="loader" class="animate-spin"></i>
                                <span>Connecting...</span>
                            </button>
                            <button
                                onclick="app.disconnect()"
                                x-show="$store.app.connected"
                                style="display: none;"
                                class="btn-sm-outline w-full">
                                <i data-lucide="bluetooth-off"></i>
                                <span>Disconnect</span>
                            </button>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#" onclick="app.switchTab('ride'); return false;" id="nav-ride" class="active">
                                <i data-lucide="bike"></i>
                                <span>Ride</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="app.switchTab('design'); return false;" id="nav-design">
                                <i data-lucide="pencil"></i>
                                <span>Design Workout</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="app.switchTab('workouts'); return false;" id="nav-workouts">
                                <i data-lucide="library"></i>
                                <span>Workouts</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="app.switchTab('session'); return false;" id="nav-session">
                                <i data-lucide="users"></i>
                                <span>Session</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </section>
        </nav>
    </aside>

    <main class="p-8 max-w-[1600px] mx-auto">
        <!-- Mobile sidebar toggle -->
        <div class="p-4 hidden md:hidden" id="mobile-nav-toggle">
            <button type="button" onclick="document.dispatchEvent(new CustomEvent('basecoat:sidebar'))" class="btn-outline">
                <i data-lucide="menu"></i>
                <span>Menu</span>
            </button>
        </div>

        <!-- Ride Tab -->
        <div class="tab-content active" id="content-ride">
        <div class="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6 p-6">
            <!-- Main Content -->
            <div class="flex flex-col gap-6">
                <!-- Session Controls -->
                <div class="flex gap-3 items-center justify-end">
                    <!-- Join Session Popover (when not connected) -->
                    <div class="popover" x-show="!$store.app.session.active">
                        <button id="session-popover-trigger" type="button" aria-expanded="false" aria-controls="session-popover-content" class="btn-outline">
                            <i data-lucide="users"></i>
                            <span>Join Session</span>
                        </button>
                        <div id="session-popover-content" data-popover aria-hidden="true" class="w-80">
                            <div class="grid gap-4">
                                <header class="grid gap-1.5">
                                    <h4 class="leading-none font-medium">Join or Create Session</h4>
                                    <p class="text-muted-foreground text-sm">Ride with friends in real-time!</p>
                                </header>
                                <form class="form grid gap-4" onsubmit="app.quickJoinSession(); return false;">
                                    <div class="grid gap-2">
                                        <label for="quickJoinName">Your Name</label>
                                        <input type="text" id="quickJoinName" placeholder="Rider name" value="Rider" class="h-8">
                                    </div>
                                    <div class="grid gap-2">
                                        <label for="quickJoinSessionCode">Session Code</label>
                                        <input type="text" id="quickJoinSessionCode" placeholder="Paste code to join" class="h-8">
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button type="submit" class="btn">
                                            <i data-lucide="users"></i>
                                            Join
                                        </button>
                                        <button type="button" onclick="app.quickCreateSession()" class="btn-outline">
                                            <i data-lucide="plus-circle"></i>
                                            Create New
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metrics -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <div class="bg-card border border-border rounded-lg p-5 transition-all hover:border-border/80 hover:shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="zap" class="size-4 text-muted-foreground"></i>
                        <span class="text-sm text-muted-foreground font-medium">Power</span>
                    </div>
                    <div class="text-3xl font-bold text-foreground mb-1 tabular-nums" x-text="$store.app.metrics.power">0</div>
                    <div class="text-xs text-muted-foreground uppercase tracking-wide">watts</div>
                </div>
                <div class="bg-card border border-border rounded-lg p-5 transition-all hover:border-border/80 hover:shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="heart" class="size-4 text-muted-foreground"></i>
                        <span class="text-sm text-muted-foreground font-medium">Heart Rate</span>
                    </div>
                    <div class="text-3xl font-bold text-foreground mb-1 tabular-nums" x-text="$store.app.metrics.heartRate">0</div>
                    <div class="text-xs text-muted-foreground uppercase tracking-wide">bpm</div>
                </div>
                <div class="bg-card border border-border rounded-lg p-5 transition-all hover:border-border/80 hover:shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="gauge" class="size-4 text-muted-foreground"></i>
                        <span class="text-sm text-muted-foreground font-medium">Cadence</span>
                    </div>
                    <div class="text-3xl font-bold text-foreground mb-1 tabular-nums" x-text="$store.app.metrics.cadence">0</div>
                    <div class="text-xs text-muted-foreground uppercase tracking-wide">rpm</div>
                </div>
                <div class="bg-card border border-border rounded-lg p-5 transition-all hover:border-border/80 hover:shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="target" class="size-4 text-muted-foreground"></i>
                        <span class="text-sm text-muted-foreground font-medium">Target</span>
                    </div>
                    <div class="text-3xl font-bold text-foreground mb-1 tabular-nums" x-text="$store.app.metrics.targetPower">--</div>
                    <div class="text-xs text-muted-foreground uppercase tracking-wide">watts</div>
                </div>
                <div class="bg-card border border-border rounded-lg p-5 transition-all hover:border-border/80 hover:shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <i data-lucide="activity" class="size-4 text-muted-foreground"></i>
                        <span class="text-sm text-muted-foreground font-medium">Status</span>
                    </div>
                    <div class="text-2xl font-bold text-foreground mb-1" x-text="$store.app.connectionStatus">--</div>
                    <div class="text-xs text-muted-foreground uppercase tracking-wide">connection</div>
                </div>
            </div>

            <!-- Chart -->
            <div class="card">
                <header class="border-b border-border">
                    <h2 class="flex items-center gap-2 text-base font-semibold">
                        <i data-lucide="line-chart" class="size-4 text-muted-foreground"></i>
                        <span>Live Data</span>
                    </h2>
                </header>
                <section>
                    <canvas id="liveChart" width="800" height="300" class="w-full h-[300px]"></canvas>
                </section>
            </div>

            <!-- Active Workout -->
            <div class="card" id="activeWorkoutCard" style="display: none;">
                <header class="border-b border-border">
                    <div class="flex items-center justify-between">
                        <h2 class="flex items-center gap-2 text-base font-semibold">
                            <i data-lucide="play-circle" class="size-4 text-muted-foreground"></i>
                            <span id="activeWorkoutName">Active Workout</span>
                        </h2>
                        <div id="workoutProgressTime" class="text-sm font-semibold text-muted-foreground tabular-nums">0:00 / 0:00</div>
                    </div>
                </header>
                <section class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-muted border border-border rounded-md border-l-4 border-l-primary">
                            <div class="text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-2">Current</div>
                            <div id="currentIntervalName" class="text-base font-bold text-foreground mb-1">--</div>
                            <div id="currentIntervalTarget" class="text-sm text-muted-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md border-l-4 border-l-muted-foreground">
                            <div class="text-xs font-semibold text-muted-foreground uppercase tracking-wide mb-2">Next</div>
                            <div id="nextIntervalName" class="text-base font-bold text-foreground mb-1">--</div>
                            <div id="nextIntervalTarget" class="text-sm text-muted-foreground tabular-nums">--</div>
                        </div>
                    </div>
                    <canvas id="workoutProgressChart" width="800" height="120" class="w-full h-[120px]"></canvas>

                    <!-- Session Participants (if in session) -->
                    <div id="workoutParticipantsSection" class="pt-6 border-t border-border" style="display: none;">
                        <div class="flex items-center gap-2 text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-4">
                            <i data-lucide="users" class="size-4"></i>
                            <span>Riding Together</span>
                        </div>
                        <div id="workoutParticipantsList" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <!-- Participants will be rendered here -->
                        </div>
                    </div>

                    <div class="flex justify-center mt-4">
                        <button onclick="workoutDesigner.stopWorkout()" id="stopWorkoutBtn" class="btn-lg-destructive">
                            <i data-lucide="square"></i>
                            <span>Stop Workout</span>
                        </button>
                    </div>
                </section>
            </div>

            <!-- Workout Summary (after completion) -->
            <div class="card" id="workoutSummaryCard" style="display: none;">
                <header class="border-b border-border">
                    <h2 class="flex items-center gap-2 text-base font-semibold">
                        <i data-lucide="check-circle" class="size-4 text-muted-foreground"></i>
                        <span>Workout Complete!</span>
                    </h2>
                </header>
                <section class="space-y-6">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Duration</div>
                            <div id="summaryDuration" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Avg Power</div>
                            <div id="summaryAvgPower" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Max Power</div>
                            <div id="summaryMaxPower" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Avg Cadence</div>
                            <div id="summaryAvgCadence" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Total Work</div>
                            <div id="summaryWork" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                        <div class="p-4 bg-muted border border-border rounded-md text-center">
                            <div class="text-xs text-muted-foreground uppercase tracking-wide mb-2">Avg HR</div>
                            <div id="summaryAvgHR" class="text-2xl font-bold text-foreground tabular-nums">--</div>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button onclick="app.downloadWorkoutTCX()" class="btn-lg flex-1">
                            <i data-lucide="upload"></i>
                            <span>Download TCX for Strava</span>
                        </button>
                        <button onclick="app.downloadWorkoutJSON()" class="btn-ghost">
                            <i data-lucide="download"></i>
                            <span>Download JSON</span>
                        </button>
                        <button onclick="app.dismissWorkoutSummary()" class="btn-ghost">
                            <i data-lucide="x"></i>
                            <span>Close</span>
                        </button>
                    </div>

                    <div class="p-4 bg-muted border-l-4 border-l-primary rounded-md space-y-2">
                        <p class="text-sm text-muted-foreground"><strong class="text-foreground">Upload to Strava:</strong></p>
                        <ol class="text-sm text-muted-foreground space-y-1 ml-5 list-decimal">
                            <li>Download the TCX file above</li>
                            <li>Go to <a href="https://www.strava.com/upload/select" target="_blank" rel="noopener" class="text-primary hover:underline">strava.com/upload/select</a></li>
                            <li>Upload the TCX file</li>
                            <li>Add title, description, and publish!</li>
                        </ol>
                        <p class="text-sm text-muted-foreground">TCX files also work with Garmin Connect, TrainingPeaks, and most fitness platforms.</p>
                    </div>
                </section>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="flex flex-col gap-6">
            <!-- Riders (when in session) -->
            <div class="card" x-show="$store.app.session.active" style="display: none;">
                <header>
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="flex items-center gap-2">
                            <i data-lucide="users"></i>
                            <span>Session</span>
                        </h2>
                        <span class="badge badge-success">
                            <i data-lucide="wifi" class="w-3 h-3"></i>
                            Connected
                        </span>
                    </div>
                    <div class="grid gap-2">
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-muted-foreground">Code:</span>
                            <div class="flex items-center gap-2">
                                <code class="bg-muted px-2 py-1 rounded text-xs" x-text="$store.app.session.sessionId || '---'">---</code>
                                <button onclick="app.copySessionInfo()" class="btn-sm-icon-outline" title="Copy session code">
                                    <i data-lucide="copy" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-muted-foreground">Riders:</span>
                            <span class="font-medium" x-text="$store.app.riderCount">0</span>
                        </div>
                    </div>
                </header>
                <section class="px-0">
                    <div id="ridersListSidebar" class="riders-list">
                        <!-- Riders will be rendered here -->
                    </div>
                </section>
                <footer>
                    <div class="grid gap-2">
                        <button onclick="app.startSyncedWorkout()" x-show="$store.app.session.isHost" class="btn w-full">
                            <i data-lucide="play"></i>
                            Start for Everyone
                        </button>
                        <button onclick="app.disconnectSession()" class="btn-destructive w-full">
                            <i data-lucide="log-out"></i>
                            Leave Session
                        </button>
                    </div>
                </footer>
            </div>

            <!-- Quick Control -->
            <div class="card">
                <header class="border-b border-border">
                    <h2 class="flex items-center gap-2 text-base font-semibold">
                        <i data-lucide="sliders" class="size-4 text-muted-foreground"></i>
                        <span>Quick Control</span>
                    </h2>
                </header>
                <section class="">
                    <div class="space-y-4">
                        <div class="space-y-2">
                            <label for="powerSlider" class="text-sm font-medium">Target Power</label>
                            <div id="powerDisplay" class="text-3xl font-bold text-center py-4 bg-muted border border-border rounded-md tabular-nums">100W</div>
                            <input type="range" id="powerSlider" min="0" max="500" value="100" oninput="app.updatePowerDisplay()" class="input w-full">
                        </div>
                        <button onclick="app.setPowerCommand()" id="setPowerBtn" disabled class="btn w-full">
                            <i data-lucide="send"></i>
                            <span>Set Power</span>
                        </button>
                    </div>
                </section>
            </div>

            <!-- Workout Control -->
            <div class="card hidden" id="workoutControlCard">
                <header>
                    <h2 class="flex items-center gap-2">
                        <i data-lucide="play-circle"></i>
                        <span>Workout Ready</span>
                    </h2>
                </header>
                <section>
                    <button onclick="workoutDesigner.startWorkout()" id="startWorkoutBtn" class="btn-lg w-full">
                        <i data-lucide="play"></i>
                        <span>Start Workout</span>
                    </button>
                </section>
            </div>

            <!-- Activity Log -->
            <details class="card" open>
                <summary class="flex justify-between cursor-pointer border-b border-border hover:bg-muted/30 transition-colors">
                    <header class="flex items-center gap-2 text-base font-semibold">
                        <i data-lucide="terminal" class="size-4 text-muted-foreground"></i>
                        <span>Activity Log</span>
                    </header>
                    <i data-lucide="chevron-down" class="chevron-rotate size-5 text-muted-foreground transition-transform"></i>
                </summary>
                <section class="p-6">
                    <div id="log" class="bg-background border border-border rounded-md font-mono text-xs p-3 h-[300px] overflow-y-auto leading-relaxed space-y-1"></div>
                </section>
            </details>
        </div>
    </div>
    </div>

    <!-- Design Tab -->
    <div class="tab-content" id="content-design">
        <div class="max-w-[1600px] mx-auto p-6">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold text-foreground">Workout Designer</h1>
                <div class="flex items-center gap-2 bg-muted border border-border rounded-md px-3 py-2">
                    <label for="ftpInput" class="text-sm text-muted-foreground font-medium">FTP:</label>
                    <input type="number" id="ftpInput" value="200" min="50" max="500" onchange="app.updateFTP()" class="w-16 bg-transparent border-none text-sm font-semibold text-foreground text-center focus:outline-none focus:ring-2 focus:ring-ring rounded">
                    <span class="text-xs text-muted-foreground">W</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-[1fr_280px] gap-6">
                <div class="space-y-6">
                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="layout" class="size-4 text-muted-foreground"></i>
                                <span>Build Your Workout</span>
                            </h2>
                        </header>
                        <section class="space-y-4">
                            <div class="flex flex-wrap gap-2">
                                <button onclick="workoutDesigner.addInterval('warmup')" class="btn-sm">
                                    <i data-lucide="sunrise"></i>
                                    <span>Warmup</span>
                                </button>
                                <button onclick="workoutDesigner.addInterval('endurance')" class="btn-sm">
                                    <i data-lucide="gauge"></i>
                                    <span>Endurance</span>
                                </button>
                                <button onclick="workoutDesigner.addInterval('tempo')" class="btn-sm">
                                    <i data-lucide="trending-up"></i>
                                    <span>Tempo</span>
                                </button>
                                <button onclick="workoutDesigner.addInterval('threshold')" class="btn-sm">
                                    <i data-lucide="flame"></i>
                                    <span>Threshold</span>
                                </button>
                                <button onclick="workoutDesigner.addInterval('vo2max')" class="btn-sm">
                                    <i data-lucide="rocket"></i>
                                    <span>VO2 Max</span>
                                </button>
                                <button onclick="workoutDesigner.addInterval('cooldown')" class="btn-sm">
                                    <i data-lucide="sunset"></i>
                                    <span>Cooldown</span>
                                </button>
                                <div class="flex-1"></div>
                                <button onclick="workoutDesigner.clearWorkout()" class="btn-sm-ghost">
                                    <i data-lucide="trash-2"></i>
                                    <span>Clear</span>
                                </button>
                            </div>
                            <div id="workoutTimeline" class="bg-muted border border-border rounded-md p-6 min-h-[180px]"></div>
                            <div class="flex items-center gap-6 p-4 bg-muted border border-border rounded-md">
                                <div class="flex items-center gap-2 text-sm text-muted-foreground font-medium">
                                    <i data-lucide="clock" class="size-4"></i>
                                    <span id="totalDuration" class="tabular-nums">0:00</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-muted-foreground font-medium">
                                    <i data-lucide="gauge" class="size-4"></i>
                                    <span id="avgPower" class="tabular-nums">0</span>W avg
                                </div>
                                <div class="flex items-center gap-2 text-sm text-muted-foreground font-medium">
                                    <i data-lucide="flame" class="size-4"></i>
                                    <span id="totalWork" class="tabular-nums">0</span>kJ
                                </div>
                            </div>
                        </section>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="save" class="size-4 text-muted-foreground"></i>
                                <span>Manage</span>
                            </h2>
                        </header>
                        <section class="space-y-2">
                            <button onclick="app.saveWorkout()" class="btn w-full">
                                <i data-lucide="save"></i>
                                <span>Save Workout</span>
                            </button>
                            <button onclick="app.exportWorkout()" class="btn-outline w-full">
                                <i data-lucide="download"></i>
                                <span>Export JSON</span>
                            </button>
                            <button onclick="app.importWorkout()" class="btn-outline w-full">
                                <i data-lucide="upload"></i>
                                <span>Import JSON</span>
                            </button>
                            <button onclick="app.loadWorkoutForRide()" class="btn-outline w-full">
                                <i data-lucide="play"></i>
                                <span>Load & Ride</span>
                            </button>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workouts Tab -->
    <div class="tab-content" id="content-workouts">
        <div class="max-w-[1600px] mx-auto p-6">
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold text-foreground">Workout Library</h1>
                <button onclick="app.importWorkout()" class="btn">
                    <i data-lucide="upload"></i>
                    <span>Import Workout</span>
                </button>
            </div>
            <div id="workoutLibrary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Workout cards will be generated here -->
            </div>
        </div>
    </div>

    <!-- Session Tab -->
    <div class="tab-content" id="content-session">
        <div class="max-w-[1400px] mx-auto p-8">
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-foreground mb-2">Ride with Friends</h1>
            </div>

            <!-- Not Connected State -->
            <div id="sessionNotConnected" class="space-y-6">
                <div class="text-center p-12 bg-card border border-border rounded-lg mb-6">
                    <i data-lucide="users" class="w-16 h-16 mx-auto mb-6 text-primary opacity-50"></i>
                    <h2 class="text-xl font-bold text-foreground mb-2">Train Together, Ride Stronger</h2>
                    <p class="text-base text-muted-foreground max-w-2xl mx-auto">Create or join a session to ride with friends. See each other's power, cadence, and race on the same workout!</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="plus-circle" class="size-4 text-muted-foreground"></i>
                                <span>Create Session</span>
                            </h2>
                        </header>
                        <section class="space-y-4">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-muted-foreground">Your Name</label>
                                <input type="text" id="hostNameInput" placeholder="Enter your name" value="Rider" class="w-full p-3 bg-muted border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            </div>
                            <button onclick="app.createSession()" class="btn-lg w-full">
                                <i data-lucide="play-circle"></i>
                                <span>Create Session</span>
                            </button>
                        </section>
                    </div>

                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="user-plus" class="size-4 text-muted-foreground"></i>
                                <span>Join Session</span>
                            </h2>
                        </header>
                        <section class="space-y-4">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-muted-foreground">Your Name</label>
                                <input type="text" id="joinNameInput" placeholder="Enter your name" value="Rider" class="w-full p-3 bg-muted border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-muted-foreground">Session Code</label>
                                <input type="text" id="sessionCodeInput" placeholder="e.g., swift-mountain-climbing-falcon" class="w-full p-3 bg-muted border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                                <p class="text-xs text-muted-foreground">Paste the full session code from your friend</p>
                            </div>
                            <button onclick="app.joinSession()" class="btn-lg w-full">
                                <i data-lucide="log-in"></i>
                                <span>Join Session</span>
                            </button>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Connected State -->
            <div id="sessionConnected" class="space-y-6" style="display: none;">
                <div class="flex items-center gap-4 bg-card border border-border rounded-lg">
                    <div class="flex items-center gap-3 flex-1">
                        <span class="text-sm text-muted-foreground font-medium">Session Code:</span>
                        <code id="sessionCodeDisplay" class="px-3 py-1.5 bg-muted text-primary font-mono text-sm rounded-md">---</code>
                        <button onclick="app.copySessionInfo()" class="btn-sm-icon-outline" title="Copy Session Code">
                            <i data-lucide="copy"></i>
                        </button>
                    </div>
                    <button onclick="app.disconnectSession()" class="btn-destructive">
                        <i data-lucide="log-out"></i>
                        <span>Leave Session</span>
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- My FTP Settings -->
                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="gauge" class="size-4 text-muted-foreground"></i>
                                <span>My FTP</span>
                            </h2>
                        </header>
                        <section class="space-y-4">
                            <div class="space-y-2">
                                <label class="text-sm font-medium text-muted-foreground">Your FTP (Watts)</label>
                                <input type="number" id="sessionFtpInput" value="200" min="50" max="500" onchange="app.updateSessionFTP()" class="w-full p-3 bg-muted border border-border rounded-md text-sm text-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                                <p class="text-xs text-muted-foreground">Workout will scale to your FTP. You can adjust this anytime!</p>
                            </div>
                        </section>
                    </div>

                    <!-- Video Chat Section -->
                    <div class="card">
                        <header class="border-b border-border">
                            <h2 class="flex items-center gap-2 text-base font-semibold">
                                <i data-lucide="video" class="size-4 text-muted-foreground"></i>
                                <span>Video Chat</span>
                            </h2>
                        </header>
                        <section class="space-y-4">
                            <p class="text-sm text-muted-foreground">Connect with your friends via Google Meet:</p>
                            <div class="space-y-2">
                                <input type="text" id="meetLinkInput" placeholder="Paste Google Meet link" class="w-full p-3 bg-muted border border-border rounded-md text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring">
                                <button onclick="app.openMeetLink()" class="btn w-full">
                                    <i data-lucide="external-link"></i>
                                    <span>Open Google Meet</span>
                                </button>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Race Track -->
                <div class="card">
                    <header class="border-b border-border">
                        <h2 class="flex items-center gap-2 text-base font-semibold">
                            <i data-lucide="flag" class="size-4 text-muted-foreground"></i>
                            <span>Race Track</span>
                        </h2>
                    </header>
                    <section class="p-6">
                        <canvas id="raceTrackCanvas" width="1000" height="300" class="w-full h-[300px] bg-muted rounded-md"></canvas>
                    </section>
                </div>

                <!-- Participants List -->
                <div class="card">
                    <header class="border-b border-border">
                        <h2 class="flex items-center gap-2 text-base font-semibold">
                            <i data-lucide="users" class="size-4 text-muted-foreground"></i>
                            <span>Participants</span>
                        </h2>
                    </header>
                    <section class="p-6">
                        <div id="participantsList" class="space-y-3">
                            <!-- Participants will be rendered here -->
                        </div>
                    </section>
                </div>

                <!-- Session Controls (Host Only) -->
                <div id="sessionHostControls" class="card" style="display: none;">
                    <header class="border-b border-border">
                        <h2 class="flex items-center gap-2 text-base font-semibold">
                            <i data-lucide="settings" class="size-4 text-muted-foreground"></i>
                            <span>Host Controls</span>
                        </h2>
                    </header>
                    <section class="space-y-4">
                        <div id="countdownDisplay" class="text-center p-8 bg-muted border-2 border-primary rounded-md" style="display: none;">
                            <div id="countdownNumber" class="text-6xl font-bold text-primary tabular-nums mb-2">5</div>
                            <div class="text-lg font-semibold text-muted-foreground uppercase tracking-wide">Get Ready!</div>
                        </div>
                        <button onclick="app.startSyncedWorkout()" id="startSyncedBtn" class="btn-lg w-full">
                            <i data-lucide="play"></i>
                            <span>Start Synchronized Workout (5s countdown)</span>
                        </button>
                        <button onclick="app.endSyncedWorkout()" id="endSyncedBtn" class="btn-destructive w-full hidden">
                            <i data-lucide="square"></i>
                            <span>End Workout for All</span>
                        </button>
                    </section>
                </div>
            </div>
        </div>
    </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/simple-peer@9.11.1/simplepeer.min.js"></script>
    <script src="ftms.js"></script>
    <script src="chart.js"></script>
    <script src="workout-preview.js"></script>
    <script src="workout-progress.js"></script>
    <script src="workout-recorder.js"></script>
    <script src="workout-designer.js"></script>
    <script src="hr-zones.js"></script>
    <script src="session-p2p.js"></script>
    <script src="racetrack.js"></script>
    <script src="app.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        // Draw workout previews after DOM is loaded
        setTimeout(() => WorkoutPreview.refreshAllPreviews(), 100);

        // Initialize range sliders with Basecoat styling
        (() => {
            const sliders = document.querySelectorAll('input[type="range"].input');
            if (!sliders) return;

            const updateSlider = (el) => {
                const min = parseFloat(el.min || 0);
                const max = parseFloat(el.max || 100);
                const value = parseFloat(el.value);
                const percent = (max === min) ? 0 : ((value - min) / (max - min)) * 100;
                el.style.setProperty('--slider-value', `${percent}%`);
            };

            sliders.forEach(slider => {
                updateSlider(slider);
                slider.addEventListener('input', (event) => updateSlider(event.target));
            });
        })();
    </script>
</body>
</html>
